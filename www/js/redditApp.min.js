(function(){function createXMLHttpRequest(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new XMLHttpRequest}catch(e){}return null}function loadScript(scriptname){var xhr=createXMLHttpRequest();xhr.onreadystatechange=function(){4==xhr.readyState&&(200!=xhr.status||appendScript(xhr.responseText))},xhr.open("GET","js/lib/"+scriptname,!0),xhr.setRequestHeader("Content-type","application/javascript"),xhr.send()}function appendScript(output){var head=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.text=output,head.appendChild(s),my.draggableLoaded=!0}window.console||(console={log:function(){}});var my={};my.defaultCategory="funny",my.category=my.defaultCategory,my.pages=[],my.articles=[],my.draggableLoaded=!1,my.canDragArticle=!0,my.canvasSupport=!0,my.currentPage=0,my.loading=!1,my.noResultsCode=null,my.before=null,my.after=null,my.urlParts=Array("https://www.reddit.com/r/","/.json"),my.ready=null,my.startCheck=function(){my.ready=setInterval(my.checkForJQuery,10)},my.checkForJQuery=function(){"undefined"!=typeof window.jQuery&&(clearInterval(my.ready),my.ready=null,$(document).ready(my.init))},my.addPageNavigation=function(before,after){$(".navigation").remove();var currentNavigation=my.returnHtmlTemplate("articleNavigation");null!=before?currentNavigation.find(".prevPage").bind("click",function(e){my.currentPage--,my.currentPage<=0?(my.currentPage=0,my.getData(my.category)):my.getData(void 0,String("after="+my.pages[my.currentPage]))}):currentNavigation.find(".prevPage").remove(),null!=after?currentNavigation.find(".nextPage").bind("click",function(e){my.getData(void 0,String("after="+after)),my.pages.push(after),my.currentPage++}):currentNavigation.find(".nextPage").remove(),$(".articles_area").append(currentNavigation)},my.returnBackCSS=function(imgSrc){return Boolean(imgSrc.match(/^(nsfw|self|default)/i))||!Boolean(String(imgSrc).match(/\w/))?!1:{"background-image":"url("+imgSrc+")"}},my.showArticles=function(output){my.stopSpinner(),$(".articles_area").empty(),my.gotoTopOfPage();var template=null;my.legacy=null;var currentrow=null;delete my.articles,my.articles=null,my.articles=[],template=$.trim($("#articleTemplate").html()),$("html").hasClass("ie8")&&(my.legacy=$.trim($("#articleActionsLegacy").html()));for(var i in output.data.children){var rowclass=i%2==0?"odd":"",article=output.data.children[i].data;my.articles.push(output.data.children[i].data),currentrow=$(template).clone(),$(currentrow).addClass(rowclass).attr("data-ref",i);var backgroundobject=my.returnBackCSS(article.thumbnail);if(backgroundobject?$(currentrow).find(".thumbnail").css(backgroundobject):$(currentrow).find(".thumbnail").addClass("noimage"),Boolean(String(article.title).match(/\s/))||(article.title=String(article.title).slice(0,20),article.title+="..."),$(currentrow).find(".title").text(article.title),$(currentrow).find(".author").text(article.author),$(currentrow).find(".num_comments em").text(String(article.num_comments)),$(currentrow).find(".ups em").text(String(article.ups)),$(currentrow).find(".downs em").text(String(article.downs)),null!=my.legacy){var legacyNav=$(my.legacy).clone();$(currentrow).find(".articleHolder").append(legacyNav),$(currentrow).find(".reddit_fallback,.email_fallback").attr("data-ref",i)}$(".articles_area").append(currentrow)}null!=my.legacy?my.legacyActions():$(".article").bind("click",my.showarticleActions),my.addPageNavigation(output.data.before,output.data.after),my.checkForNoValueInSearch(),loadScript("externals.js"),delete article,template,currentrow=article=template=null},my.legacyActions=function(e){$(".reddit_fallback").bind("click",function(e){var currentArticle=my.articles[$(e.currentTarget).attr("data-ref")],redditURL="https://www.reddit.com"+currentArticle.permalink;my.openLinkInWindow(redditURL)}).attr,$(".email_fallback").bind("click",function(e){var currentArticle=my.articles[$(e.currentTarget).attr("data-ref")],redditURL="https://www.reddit.com"+currentArticle.permalink;my.openEmailPrompt(redditURL)})},my.checkForNoValueInSearch=function(){var searchval=$(".search_field").val();Boolean(searchval.match(/\w/))||$(".search_field").val(my.defaultCategory)},my.gotoTopOfPage=function(){0!=$("body").scrollTop()&&$("body").stop().animate({scrollTop:0},1e3)},my.getData=function(category,direction){"undefined"!=typeof category&&"undefined"==typeof direction&&(my.category=category),Boolean(my.category.match(/\w/))||(my.category=my.defaultCategory);var urlParams="";"undefined"!=typeof direction&&(urlParams="?count=25&"+direction),($("html").hasClass("ie9")||$("html").hasClass("ie8"))&&(my.urlParts[0]=my.urlParts[0].replace("https","http"));var fullURL=String(my.urlParts[0]+my.category+my.urlParts[1]+urlParams);console.log(fullURL);var promise=$.ajax({url:fullURL,dataType:"json",type:"GET"});promise.success(my.showArticles),promise.error(function(jqXHR,textStatus,errorThrown){console.log(jqXHR.responseText),my.showNoResults()})},my.showNoResults=function(){$(my.noResultsCode).find("span").text(my.category),$(".articles_area").html(my.noResultsCode),my.stopSpinner()},my.returnHtmlTemplate=function(id){var template=$.trim($(String("#"+id)).html());return $(template).clone()},my.searchFieldAction=function(keepClass){my.getData($(".search_field").val()),"undefined"==typeof keepClass&&$(".search_field").removeClass("expanded")},my.snapBackObject=function(id,delay){var butn=document.getElementById(id),coord=String($(butn).attr("data-ref")).split(":"),props={x:coord[0],y:coord[1],onComplete:function(){$("#articleButton").removeClass("fiftyPercent")}};"undefined"!=typeof delay&&(props.delay=.5),TweenLite.to(butn,.25,props)},my.addRemoveActionsClick=function(remove){"undefined"!=typeof remove?$(".actionsCloser").unbind("click",my.removeOverlay):$(".actionsCloser").bind("click",my.removeOverlay)},my.removeOverlay=function(){$("#actions").remove(),$("body").removeClass("overlay")},my.openLinkInWindow=function(link){window.open(link,"redditLink")},my.openEmailPrompt=function(link){window.location.href="mailto:?subject=Check%20out%20this%20Reddit%20post&body="+link},my.checkForDrag=function(e){var butn=document.getElementById("articleButton");if("undefined"!=typeof butn&&"undefined"!=typeof window.matchMedia){var smallScreens=!window.matchMedia("(min-width: 30em)").matches&&window.matchMedia("(max-width: 30em)").matches?!0:!1,articlePosition=String($("#articleButton").css("position")),articlePositionRelative=Boolean(articlePosition.match(/relative/i))?!0:!1;smallScreens||articlePositionRelative?my.canDragArticle=!1:my.canDragArticle=!0}else my.canDragArticle=!1},my.showarticleActions=function(e){var currentArticle=my.articles[$(e.currentTarget).attr("data-ref")],redditURL="https://www.reddit.com"+currentArticle.permalink;if(my.draggableLoaded){if(null==my.legacy){var actionArea=my.returnHtmlTemplate("articleActions");Boolean(String(currentArticle.title).match(/\s/))||(currentArticle.title=String(currentArticle.title).slice(0,20),currentArticle.title+="..."),actionArea.find(".title").text(currentArticle.title),actionArea.find(".author").text(currentArticle.author),actionArea.find(".ups").text(currentArticle.ups),actionArea.find(".downs").text(currentArticle.downs);var characterCount=Number(String(currentArticle.ups).length)+Number(String(currentArticle.downs).length);characterCount>5&&actionArea.find(".votesHolder").addClass("wider");var backgroundobject=my.returnBackCSS(currentArticle.thumbnail);backgroundobject?$(actionArea).find(".thumbnail").css(backgroundobject):$(actionArea).find(".thumbnail").addClass("noimage"),$("body").append(actionArea).addClass("overlay"),TweenLite.to("#actions",.25,{opacity:1}),my.addRemoveActionsClick(),my.checkForDrag(),$(".drag,.nodrag").hide()}if(my.canDragArticle&&null==my.legacy)$(".drag").show(),Draggable.create("#articleButton",{type:"x,y",edgeResistance:.65,bounds:"#actions",onDragStart:function(){var attr=$("#articleButton").attr("data-ref");$("#articleButton").addClass("fiftyPercent"),"undefined"==typeof attr&&$("#articleButton").attr("data-ref",String(this.x+":"+this.y))},onDragEnd:function(){this.hitTest("#redditLink","80%")?(my.openLinkInWindow(redditURL),my.snapBackObject("articleButton",!0)):this.hitTest("#emailLink","80%")?(my.openEmailPrompt(redditURL),my.snapBackObject("articleButton",!0)):my.snapBackObject("articleButton")}});else{$(".nodrag").show();var articleButton=document.getElementById("articleButton");"undefined"!=typeof articleButton&&$("#articleButton").bind("click",function(){my.removeOverlay()}),$("#redditLink").bind("click",function(){my.openLinkInWindow(redditURL)}),$("#emailLink").bind("click",function(){my.openEmailPrompt(redditURL)})}delete backgroundobject,backgroundobject=null}},my.initializeTickers=function(){window.ticker=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return window.setTimeout(callback,1e3/60)}}(),window.stopTicker=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()};var spinner={radius:64,points:[],sections:12,speed:30,canvas:document.createElement("canvas"),holder:null};return my.createPreloaderCanvas=function(attachToId,initObject){for(var halfRadius=initObject.radius/2-3,i=0;i<initObject.sections;i++){var startX=0+halfRadius/2*Math.cos(2*Math.PI*i/initObject.sections),startY=0+halfRadius/2*Math.sin(2*Math.PI*i/initObject.sections),endX=0+halfRadius*Math.cos(2*Math.PI*i/initObject.sections),endY=0+halfRadius*Math.sin(2*Math.PI*i/initObject.sections);initObject.points.push([startX,startY,endX,endY])}initObject.canvas.width=initObject.radius,initObject.canvas.height=initObject.radius,initObject.canvas.id="spinner",console.log(window.CanvasRenderingContext2D),"undefined"==typeof window.CanvasRenderingContext2D?my.canvasSupport=!1:(initObject.context=initObject.canvas.getContext("2d"),initObject.context.translate(initObject.radius/2,initObject.radius/2),document.body.appendChild(initObject.canvas)),my.initializeTickers()},my.drawSpinner=function(){var c=spinner.context,r=spinner.radius,p=spinner.points;c.translate(-(r/2),-(r/2)),c.globalAlpha=1,c.clearRect(0,0,r,r),c.translate(r/2,r/2),c.rotate(Math.PI/spinner.speed);var alpha=.5,inc=.1;for(var i in p)i>5&&(alpha+=inc),c.globalAlpha=alpha,c.lineWidth=5,c.strokeStyle="#03b6fd",c.lineCap="round",c.beginPath(),c.moveTo(p[i][0],p[i][1]),c.lineTo(p[i][2],p[i][3]),c.stroke();c.globalAlpha=1,my.loading&&window.ticker(my.drawSpinner)},my.startSpinner=function(){my.loading=!0,my.canvasSupport&&(spinner.canvas.style.display="block",my.drawSpinner())},my.stopSpinner=function(){my.loading=!1,my.canvasSupport&&(spinner.canvas.style.display="none")},my.assignFunctions=function(){$(".search_field").focus(function(){var text=String($(this).val());$(this).addClass("expanded"),Boolean(text.match(/\w/i))||$(this).val("")}).val(my.category),$(".search_field").blur(function(){my.searchFieldAction()}),$(".search_field").keypress(function(e){13==e.which&&(e.preventDefault(),my.searchFieldAction(!0))}),$(".search_field").keyup(function(e){String($(this).val()).length>2&&my.searchFieldAction(!0)}),$(window).resize(my.checkForDrag)},my.init=function(){my.createPreloaderCanvas("allArticles",spinner),my.getData(),my.assignFunctions(),my.noResultsCode=my.returnHtmlTemplate("articletemplateNoresults")},my})().startCheck();