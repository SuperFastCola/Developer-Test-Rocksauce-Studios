(function(){function createXMLHttpRequest(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new XMLHttpRequest}catch(e){}return null}function loadScript(scriptname){var xhr=createXMLHttpRequest();xhr.onreadystatechange=function(){4==xhr.readyState&&(200!=xhr.status||appendScript(xhr.responseText))},xhr.open("GET","js/lib/"+scriptname,!0),xhr.setRequestHeader("Content-type","application/javascript"),xhr.send()}function appendScript(output){var head=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.text=output,head.appendChild(s),my.draggableLoaded=!0}window.console||(console={log:function(){}});var my={};return my.defaultCategory="funny",my.category=my.defaultCategory,my.pages=[],my.articles=[],my.draggableLoaded=!1,my.canDragArticle=!0,my.currentPage=0,my.before=null,my.after=null,my.urlParts=Array("https://www.reddit.com/r/","/.json"),my.ready=null,my.startCheck=function(){my.ready=setInterval(my.checkForJQuery,10)},my.checkForJQuery=function(){"undefined"!=typeof window.jQuery&&(clearInterval(my.ready),my.ready=null,$(document).ready(my.init))},my.addPageNavigation=function(before,after){$(".navigation").remove();var currentNavigation=my.returnHtmlTemplate("articleNavigation");null!=before?currentNavigation.find(".prevPage").bind("click",function(e){my.currentPage--,my.currentPage<=0?(my.currentPage=0,my.getData(my.category)):my.getData(void 0,String("after="+my.pages[my.currentPage]))}):currentNavigation.find(".prevPage").remove(),null!=after?currentNavigation.find(".nextPage").bind("click",function(e){my.getData(void 0,String("after="+after)),my.pages.push(after),my.currentPage++}):currentNavigation.find(".nextPage").remove(),$(".articles_area").append(currentNavigation)},my.returnBackCSS=function(imgSrc){return Boolean(imgSrc.match(/^(nsfw|self|default)/i))||!Boolean(String(imgSrc).match(/\w/))?!1:{"background-image":"url("+imgSrc+")"}},my.showArticles=function(output){$(".articles_area").empty(),my.gotoTopOfPage();var template=null,currentrow=null;delete my.articles,my.articles=null,my.articles=[],template=$.trim($("#articleTemplate").html());for(var i in output.data.children){var rowclass=i%2==0?"odd":"",article=output.data.children[i].data;my.articles.push(output.data.children[i].data),currentrow=$(template).clone(),$(currentrow).addClass(rowclass).attr("data-ref",i);var backgroundobject=my.returnBackCSS(article.thumbnail);backgroundobject?$(currentrow).find(".thumbnail").css(backgroundobject):$(currentrow).find(".thumbnail").addClass("noimage"),$(currentrow).find(".title").text(article.title),$(currentrow).find(".author").text(article.author),$(currentrow).find(".num_comments em").text(String(article.num_comments)),$(currentrow).find(".ups em").text(String(article.ups)),$(currentrow).find(".downs em").text(String(article.downs)),$(".articles_area").append(currentrow)}$(".article").bind("click",my.showarticleActions),my.addPageNavigation(output.data.before,output.data.after),my.checkForNoValueInSearch(),loadScript("externals.js"),delete article,template,currentrow=article=template=null},my.checkForNoValueInSearch=function(){var searchval=$(".search_field").val();Boolean(searchval.match(/\w/))||$(".search_field").val(my.defaultCategory)},my.gotoTopOfPage=function(){var body=$("body, html");0!=body.scrollTop()&&body.stop().animate({scrollTop:0},1e3)},my.getData=function(category,direction){"undefined"!=typeof category&&"undefined"==typeof direction&&(my.category=category),Boolean(my.category.match(/\w/))||(my.category=my.defaultCategory);var urlParams="";"undefined"!=typeof direction&&(urlParams="?count=25&"+direction);var fullURL=String(my.urlParts[0]+my.category+my.urlParts[1]+urlParams),promise=$.ajax({url:fullURL,dataType:"json",type:"GET"});promise.success(my.showArticles),promise.error(function(jqXHR,textStatus,errorThrown){console.log(jqXHR.responseText)})},my.returnHtmlTemplate=function(id){var template=$.trim($(String("#"+id)).html());return $(template).clone()},my.searchFieldAction=function(keepClass){my.getData($(".search_field").val()),"undefined"==typeof keepClass&&$(".search_field").removeClass("expanded")},my.snapBackObject=function(id,delay){var butn=document.getElementById(id),coord=String($(butn).attr("data-ref")).split(":"),props={x:coord[0],y:coord[1],onComplete:function(){$("#articleButton").removeClass("fiftyPercent")}};"undefined"!=typeof delay&&(props.delay=.5),TweenLite.to(butn,.25,props)},my.addRemoveActionsClick=function(remove){"undefined"!=typeof remove?$(".actionsCloser").unbind("click",my.removeOverlay):$(".actionsCloser").bind("click",my.removeOverlay)},my.removeOverlay=function(){$("#actions").remove(),$("body").removeClass("overlay")},my.openLinkInWindow=function(link){window.open(link,"redditLink")},my.openEmailPrompt=function(link){window.location.href="mailto:?subject=Check%20out%20this%20Reddit%20post&body="+link},my.checkForDrag=function(e){var butn=document.getElementById("articleButton");if("undefined"!=typeof butn){var smallScreens=!window.matchMedia("(min-width: 30em)").matches&&window.matchMedia("(max-width: 30em)").matches?!0:!1,articlePosition=String($("#articleButton").css("position")),articlePositionRelative=Boolean(articlePosition.match(/relative/i))?!0:!1;console.log($("#articleButton").css("position")),console.log(articlePositionRelative),console.log(smallScreens),smallScreens||articlePositionRelative?my.canDragArticle=!1:my.canDragArticle=!0}},my.showarticleActions=function(e){if(my.draggableLoaded){var actionArea=my.returnHtmlTemplate("articleActions"),currentArticle=my.articles[$(e.currentTarget).attr("data-ref")];actionArea.find(".title").text(currentArticle.title),actionArea.find(".author").text(currentArticle.author),actionArea.find(".ups").text(currentArticle.ups),actionArea.find(".downs").text(currentArticle.downs);var characterCount=Number(String(currentArticle.ups).length)+Number(String(currentArticle.downs).length);characterCount>5&&actionArea.find(".votesHolder").addClass("wider");var backgroundobject=my.returnBackCSS(currentArticle.thumbnail);backgroundobject?$(actionArea).find(".thumbnail").css(backgroundobject):$(actionArea).find(".thumbnail").addClass("noimage"),$("body").append(actionArea).addClass("overlay"),TweenLite.to("#actions",.25,{opacity:1}),my.addRemoveActionsClick();var redditURL="https://www.reddit.com"+currentArticle.permalink;my.checkForDrag(),$(".drag,.nodrag").hide(),my.canDragArticle?($(".drag").show(),Draggable.create("#articleButton",{type:"x,y",edgeResistance:.65,bounds:"#actions",onDragStart:function(){var attr=$("#articleButton").attr("data-ref");$("#articleButton").addClass("fiftyPercent"),"undefined"==typeof attr&&$("#articleButton").attr("data-ref",String(this.x+":"+this.y))},onDragEnd:function(){this.hitTest("#redditLink","80%")?(my.openLinkInWindow(redditURL),my.snapBackObject("articleButton",!0)):this.hitTest("#emailLink","80%")?(my.openEmailPrompt(redditURL),my.snapBackObject("articleButton",!0)):my.snapBackObject("articleButton")}})):($(".nodrag").show(),$("#articleButton").bind("click",function(){my.removeOverlay()}),$("#redditLink").bind("click",function(){my.openLinkInWindow(redditURL)}),$("#emailLink").bind("click",function(){my.openEmailPrompt(redditURL)})),delete backgroundobject,backgroundobject=null}},my.assignFunctions=function(){$(".search_field").focus(function(){var text=String($(this).val());$(this).addClass("expanded"),Boolean(text.match(/\w/i))||$(this).val("")}).val(my.category),$(".search_field").blur(function(){my.searchFieldAction()}),$(".search_field").keypress(function(e){13==e.which&&(e.preventDefault(),my.searchFieldAction(!0))}),$(".search_field").keyup(function(e){String($(this).val()).length>2&&my.searchFieldAction(!0)}),$(window).resize(my.checkForDrag)},my.init=function(){my.getData(),my.assignFunctions()},my})().startCheck();